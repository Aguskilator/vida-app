<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - VIDA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="Vidalogo.png" type="image/png">
    <style>
        :root {
            --vida-primary-blue: #0D47A1;
            --vida-secondary-blue: #1565C0;
            --vida-accent-blue: #1976D2;
            --vida-light-blue: #E3F2FD;
            --vida-btn-green: #4CAF50;
            --vida-btn-green-hover: #45A049;
            --vida-text-dark: #1E293B;
            --vida-bg-footer: #F8FAFC;
        }
        
        .fade-in {
            opacity: 0;
            animation: fadeIn 0.6s ease-in-out forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .question-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .answer-btn {
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            border: 2px solid transparent;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .answer-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #45A049;
        }
        
        .answer-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #d32f2f;
        }
        
        .answer-btn.default {
            background: #f8f9fa;
            color: #1E293B;
            border-color: #e9ecef;
        }
        
        .progress-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--vida-primary-blue), var(--vida-accent-blue));
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="quiz-container">
        <header class="text-center mb-8 fade-in">
            <img src="Vidalogo.png" alt="VIDA" class="mx-auto h-16 mb-4">
            <h1 class="text-3xl font-bold text-[var(--vida-primary-blue)] mb-2">
                Desmitificador Express
            </h1>
            <p class="text-gray-600">
                Pon a prueba tus conocimientos sobre donaci√≥n de √≥rganos
            </p>
        </header>

        <div id="quiz-content" class="fade-in">
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>

            <div id="welcome-screen" class="question-card text-center">
                <h2 class="text-2xl font-bold mb-4">¬°Bienvenido al Quiz!</h2>
                <p class="text-gray-600 mb-6">
                    Responde preguntas de verdadero o falso para desmentir mitos 
                    y conocer m√°s sobre la donaci√≥n de √≥rganos en M√©xico.
                </p>
                <button id="start-quiz" class="answer-btn correct">
                    üöÄ Comenzar Quiz
                </button>
            </div>

            <div id="quiz-screen" class="hidden">
                <div class="question-card">
                    <div class="flex justify-between items-center mb-4">
                        <span id="question-counter" class="text-sm font-medium text-gray-500">
                            Pregunta 1 de 5
                        </span>
                        <span id="score-display" class="text-sm font-medium text-[var(--vida-primary-blue)]">
                            Puntaje: 0/0
                        </span>
                    </div>
                    
                    <h3 id="question-text" class="text-xl font-bold mb-6 text-[var(--vida-text-dark)]">
                        <!-- Aqu√≠ aparecer√° la pregunta -->
                    </h3>
                    
                    <div class="space-y-3">
                        <button id="btn-true" class="answer-btn default">
                            ‚úÖ Verdadero
                        </button>
                        <button id="btn-false" class="answer-btn default">
                            ‚ùå Falso
                        </button>
                    </div>
                    
                    <div id="explanation" class="hidden mt-6 p-4 bg-blue-50 rounded-lg">
                        <h4 class="font-bold mb-2">Explicaci√≥n:</h4>
                        <p id="explanation-text" class="text-gray-700"></p>
                    </div>
                    
                    <button id="next-question" class="hidden mt-4 answer-btn default">
                        Siguiente pregunta ‚Üí
                    </button>
                </div>
            </div>

            <div id="results-screen" class="hidden">
                <div class="question-card text-center">
                    <h2 class="text-2xl font-bold mb-4">¬°Quiz Completado!</h2>
                    <div class="text-6xl mb-4">üéâ</div>
                    <p id="final-score" class="text-xl mb-4"></p>
                    <p class="text-gray-600 mb-6">
                        Gracias por aprender sobre donaci√≥n de √≥rganos con VIDA.
                    </p>
                    <div class="space-y-3">
                        <button id="restart-quiz" class="answer-btn correct">
                            üîÑ Reiniciar Quiz
                        </button>
                        <button id="back-to-chat" class="answer-btn default">
                            üí¨ Volver al Chat
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado del quiz
        let currentQuestion = 0;
        let score = 0;
        let questions = [];
        let totalQuestions = 5;

        // Elementos del DOM
        const welcomeScreen = document.getElementById('welcome-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startQuizBtn = document.getElementById('start-quiz');
        const questionText = document.getElementById('question-text');
        const btnTrue = document.getElementById('btn-true');
        const btnFalse = document.getElementById('btn-false');
        const explanation = document.getElementById('explanation');
        const explanationText = document.getElementById('explanation-text');
        const nextQuestionBtn = document.getElementById('next-question');
        const questionCounter = document.getElementById('question-counter');
        const scoreDisplay = document.getElementById('score-display');
        const progressFill = document.getElementById('progress-fill');
        const finalScore = document.getElementById('final-score');
        const restartQuizBtn = document.getElementById('restart-quiz');
        const backToChatBtn = document.getElementById('back-to-chat');

        // Preguntas de ejemplo (en producci√≥n estas vendr√≠an de la API)
        const sampleQuestions = [
            {
                question: "Los donantes de √≥rganos no pueden tener un funeral con ata√∫d abierto",
                isTrue: false,
                explanation: "Falso. Despu√©s de la donaci√≥n, el cuerpo se trata con respeto y se reconstituye para que la familia pueda tener un funeral normal, incluyendo ata√∫d abierto si as√≠ lo desean."
            },
            {
                question: "Solo las personas j√≥venes pueden ser donantes de √≥rganos",
                isTrue: false,
                explanation: "Falso. No existe l√≠mite de edad para ser donante. Se eval√∫a la viabilidad de cada √≥rgano individualmente, y personas mayores pueden donar c√≥rneas, tejidos y algunos √≥rganos."
            },
            {
                question: "La muerte encef√°lica es lo mismo que estar en coma",
                isTrue: false,
                explanation: "Falso. La muerte encef√°lica es la p√©rdida total e irreversible de todas las funciones cerebrales, mientras que el coma es un estado de inconsciencia del cual la persona puede recuperarse."
            },
            {
                question: "En M√©xico, la familia debe autorizar la donaci√≥n aunque la persona haya manifestado su voluntad",
                isTrue: true,
                explanation: "Verdadero. Seg√∫n la ley mexicana, aunque una persona haya expresado su voluntad de donar, la familia debe dar su autorizaci√≥n en el hospital para proceder con la donaci√≥n."
            },
            {
                question: "Los √≥rganos donados se asignan por orden de llegada",
                isTrue: false,
                explanation: "Falso. Los √≥rganos se asignan seg√∫n criterios m√©dicos estrictos: compatibilidad, gravedad del caso, tiempo en lista de espera y proximidad geogr√°fica, no por orden de llegada."
            }
        ];

        // Event listeners
        startQuizBtn.addEventListener('click', startQuiz);
        btnTrue.addEventListener('click', () => answerQuestion(true));
        btnFalse.addEventListener('click', () => answerQuestion(false));
        nextQuestionBtn.addEventListener('click', nextQuestion);
        restartQuizBtn.addEventListener('click', restartQuiz);
        backToChatBtn.addEventListener('click', () => {
            window.location.href = 'index.html';
        });

        function startQuiz() {
            welcomeScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            // Usar preguntas de ejemplo
            questions = [...sampleQuestions];
            currentQuestion = 0;
            score = 0;
            
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestion >= questions.length) {
                showResults();
                return;
            }

            const question = questions[currentQuestion];
            questionText.textContent = question.question;
            
            // Reset buttons
            btnTrue.classList.remove('correct', 'incorrect');
            btnTrue.classList.add('default');
            btnFalse.classList.remove('correct', 'incorrect');
            btnFalse.classList.add('default');
            btnTrue.disabled = false;
            btnFalse.disabled = false;
            
            // Hide explanation and next button
            explanation.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            
            // Update counters
            questionCounter.textContent = `Pregunta ${currentQuestion + 1} de ${questions.length}`;
            scoreDisplay.textContent = `Puntaje: ${score}/${currentQuestion}`;
            
            // Update progress bar
            const progress = ((currentQuestion) / questions.length) * 100;
            progressFill.style.width = `${progress}%`;
        }

        function answerQuestion(userAnswer) {
            const question = questions[currentQuestion];
            const isCorrect = userAnswer === question.isTrue;
            
            // Disable buttons
            btnTrue.disabled = true;
            btnFalse.disabled = true;
            
            // Show correct answer
            if (question.isTrue) {
                btnTrue.classList.remove('default');
                btnTrue.classList.add('correct');
                if (!isCorrect) {
                    btnFalse.classList.remove('default');
                    btnFalse.classList.add('incorrect');
                }
            } else {
                btnFalse.classList.remove('default');
                btnFalse.classList.add('correct');
                if (!isCorrect) {
                    btnTrue.classList.remove('default');
                    btnTrue.classList.add('incorrect');
                }
            }
            
            // Update score
            if (isCorrect) {
                score++;
            }
            
            // Show explanation
            explanationText.textContent = question.explanation;
            explanation.classList.remove('hidden');
            nextQuestionBtn.classList.remove('hidden');
            
            // Update score display
            scoreDisplay.textContent = `Puntaje: ${score}/${currentQuestion + 1}`;
        }

        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            const percentage = Math.round((score / questions.length) * 100);
            finalScore.textContent = `Tu puntuaci√≥n: ${score}/${questions.length} (${percentage}%)`;
            
            // Complete progress bar
            progressFill.style.width = '100%';
        }

        function restartQuiz() {
            resultsScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            
            currentQuestion = 0;
            score = 0;
            progressFill.style.width = '0%';
        }

        // Generar preguntas desde la API (comentado para usar preguntas de ejemplo)
        async function generateQuestions() {
            try {
                const response = await fetch('/api/openai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        prompt: [
                            { role: "system", content: "Eres VIDA, un asistente de donaci√≥n de √≥rganos. Genera 5 preguntas de verdadero/falso sobre mitos de donaci√≥n de √≥rganos en M√©xico. Devuelve un array JSON con objetos que tengan: question, isTrue, explanation." },
                            { role: "user", content: "Genera 5 preguntas de verdadero/falso sobre donaci√≥n de √≥rganos" }
                        ]
                    })
                });

                const result = await response.json();
                if (result.choices && result.choices[0]) {
                    const content = result.choices[0].message.content;
                    try {
                        questions = JSON.parse(content);
                    } catch (e) {
                        console.error('Error parsing questions:', e);
                        questions = sampleQuestions;
                    }
                }
            } catch (error) {
                console.error('Error generating questions:', error);
                questions = sampleQuestions;
            }
        }
    </script>
</body>
</html>
